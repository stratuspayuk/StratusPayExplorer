<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>StratusPay Explorer — Demo</title>
  <style>
    :root{--bg:#f4f7fb;--card:#ffffff;--accent:#0b69ff;--muted:#6b7280;--glass:rgba(11,102,255,0.06)}
    body{font-family:Inter,Segoe UI,system-ui,Arial;margin:24px;background:linear-gradient(180deg,#f7fbff 0%,var(--bg) 100%);color:#0f172a}
    .card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(8,18,40,0.06);max-width:1100px;margin:0 auto}
    .header{display:flex;justify-content:space-between;gap:16px;align-items:center}
    h1{margin:0;font-size:1.6rem}
    .muted{color:var(--muted);margin:4px 0}
    .small{font-size:12px;color:var(--muted);}
    input,select{width:100%;padding:10px;margin-top:6px;border:1px solid #e6eef8;background:#fff;border-radius:8px;box-shadow:inset 0 1px 0 rgba(16,24,40,0.02)}
    label{display:block;margin-top:10px;font-weight:600;color:#0f172a}
    .main-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.6),#fff);padding:16px;border-radius:10px;border:1px solid rgba(15,23,42,0.03)}
    .form-panel .fields{display:flex;flex-direction:column;gap:12px}
    .toolbar{display:flex;gap:8px;align-items:center}
    .toolbar select{width:auto}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .controls{display:flex;gap:8px;margin-top:8px}
    button{padding:10px 14px;border-radius:8px;border:0;cursor:pointer;background:var(--accent);color:white}
    .ghost{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--accent);padding:8px 10px}
    .secondary{background:#eef2ff;color:#0b69ff}
    .output-top{display:flex;justify-content:space-between;align-items:center}
    .output-body{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .box{background:#0b1220;color:#e6eef8;padding:12px;border-radius:8px;min-height:220px;overflow:auto}
    .note{font-size:13px;color:var(--muted);margin-top:10px}
    pre{white-space:pre-wrap}
    .actions input{width:360px}
    @media(max-width:900px){.main-grid{grid-template-columns:1fr}.actions input{width:100%}}
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <div>
        <h1>StratusPay Explorer</h1>
        <p class="muted">Interactive demo — call the hosted StratusPay API to explore payroll calculations.</p>
      </div>
      <div class="actions">
        <label class="small">API Base URL</label>
        <input id="apiBase" value="https://app-stratuspayapi-prototype-a8bhacf4dqhtgxag.ukwest-01.azurewebsites.net" />
      </div>
    </div>

    <div class="main-grid">
      <section class="panel form-panel">
        <div class="toolbar">
          <label class="small">Scenarios</label>
          <select id="scenarioSelect"></select>
          <button id="applyScenario" class="ghost">Apply</button>
        </div>

        <div class="fields">
          <div class="row">
            <div class="col">
              <label>Annual Gross Salary</label>
              <input id="annualGrossSalary" type="number" value="30000" />
            </div>
            <div class="col">
              <label>Pay Frequency</label>
              <select id="payFrequency">
                <option>Monthly</option>
                <option>Weekly</option>
                <option>FourWeekly</option>
                <option>Annual</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Tax Code</label>
              <input id="taxCode" value="1257L" />
            </div>
            <div class="col">
              <label>Pay Period Date</label>
              <input id="payPeriodDate" type="date" value="2025-06-01" />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Employee Pension %</label>
              <input id="employeePension" type="number" value="5" />
            </div>
            <div class="col">
              <label>Employer Pension %</label>
              <input id="employerPension" type="number" value="3" />
            </div>
          </div>

          <label>Pension Type</label>
          <select id="pensionType">
            <option>None</option>
            <option>ReliefAtSource</option>
            <option>NetPayArrangement</option>
            <option>SalarySacrifice</option>
            <option>AutoEnrolment</option>
          </select>

          <div class="controls">
            <button id="calc">Run calculation</button>
            <button id="copy" class="secondary">Copy JSON</button>
            <button id="download" class="secondary">Download Request</button>
          </div>
        </div>
      </section>

      <section class="panel output-panel">
        <div class="output-top">
          <div>
            <h3>Request</h3>
            <p class="muted small">JSON sent to the API</p>
          </div>
          <div>
            <h3>Response</h3>
            <p class="muted small">Raw API response</p>
          </div>
        </div>

        <div class="output-body">
          <pre id="req" class="box">{}</pre>
          <pre id="res" class="box">(no response yet)</pre>
        </div>

        <p class="note">Tip: If you see a CORS error, add <code>https://stratuspayuk.github.io</code> to your API's allowed origins in Azure App Service CORS or host this page on an allowed origin.</p>
      </section>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const apiBaseInput = $('apiBase');
    const reqArea = $('req');
    const resArea = $('res');
    const scenarioSelect = $('scenarioSelect');

    const scenarios = [
      {
        id: 'basic-monthly',
        name: 'Basic Monthly (Standard Employee)',
        data: { annualGrossSalary: 30000, taxCode: '1257L', payFrequency: 'Monthly', payPeriodDate: '2025-06-01', employeeContributionPercentage: 5, employerContributionPercentage: 3, pensionType: 'ReliefAtSource' }
      },
      {
        id: 'zero-salary',
        name: 'Zero Salary (edge case)',
        data: { annualGrossSalary: 0, taxCode: '0T', payFrequency: 'Monthly', payPeriodDate: '2025-06-01' }
      },
      {
        id: 'salary-sacrifice',
        name: 'Salary Sacrifice (pension via sacrifice)',
        data: { annualGrossSalary: 45000, taxCode: '1257L', payFrequency: 'Monthly', payPeriodDate: '2025-06-01', employeeContributionPercentage: 8, employerContributionPercentage: 5, pensionType: 'SalarySacrifice' }
      },
      {
        id: 'scottish-resident',
        name: 'Scottish Resident (Scottish tax bands)',
        data: { annualGrossSalary: 40000, taxCode: 'S1257L', payFrequency: 'Monthly', payPeriodDate: '2025-06-01', isScottishResident: true }
      },
      {
        id: 'student-loan-plan1',
        name: 'Student Loan (Plan 1)',
        data: { annualGrossSalary: 30000, taxCode: '1257L', payFrequency: 'Monthly', payPeriodDate: '2025-06-01', isPlan1: true }
      },
      {
        id: 'high-earner',
        name: 'High Earner (tax band testing)',
        data: { annualGrossSalary: 180000, taxCode: '1257L', payFrequency: 'Monthly', payPeriodDate: '2025-06-01' }
      }
    ];

    function populateScenarioList() {
      scenarios.forEach(s => {
        const o = document.createElement('option');
        o.value = s.id; o.textContent = s.name; scenarioSelect.appendChild(o);
      });
    }

    function applyScenarioById(id) {
      const s = scenarios.find(x => x.id === id);
      if (!s) return;
      const d = s.data;
      $('annualGrossSalary').value = d.annualGrossSalary ?? 0;
      $('taxCode').value = d.taxCode ?? '1257L';
      $('payFrequency').value = d.payFrequency ?? 'Monthly';
      $('payPeriodDate').value = d.payPeriodDate ?? new Date().toISOString().slice(0,10);
      $('employeePension').value = d.employeeContributionPercentage ?? 0;
      $('employerPension').value = d.employerContributionPercentage ?? 0;
      $('pensionType').value = d.pensionType ?? 'None';
      // optional flags
      // these fields are present on the API model but not in the main form; we include them in the request builder
    }

    function buildRequest() {
      const body = {
        uniqueEmployeeId: 'DEMO-001',
        annualGrossSalary: Number($('annualGrossSalary').value) || 0,
        taxCode: $('taxCode').value || '1257L',
        payFrequency: $('payFrequency').value,
        payPeriodDate: $('payPeriodDate').value,
        employeeContributionPercentage: Number($('employeePension').value) || 0,
        employerContributionPercentage: Number($('employerPension').value) || 0,
        pensionType: $('pensionType').value || 'None',
        isPlan1: false,
        isPlan2: false,
        isPlan4: false,
        isPlan5: false,
        isPostgraduate: false,
        isScottishResident: false,
        isBlindPerson: false
      };
      return body;
    }

    function showRequest(body) { reqArea.textContent = JSON.stringify(body, null, 2); }
    function showResponse(obj) { resArea.textContent = JSON.stringify(obj, null, 2); }

    async function runCalc() {
      resArea.textContent = 'Calling API...';
      const apiBase = apiBaseInput.value.trim().replace(/\/$/, '');
      const url = apiBase + '/api/v1/payroll/calculate';
      const body = buildRequest();
      showRequest(body);

      try {
        const resp = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const text = await resp.text();
        let parsed;
        try { parsed = JSON.parse(text); } catch { parsed = text; }
        showResponse({ status: resp.status, ok: resp.ok, body: parsed });
      } catch (err) {
        showResponse({ error: String(err) });
      }
    }

    function downloadRequest() {
      const body = buildRequest();
      const blob = new Blob([JSON.stringify(body, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'stratuspay-request.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // wire up
    populateScenarioList();
    $('applyScenario').addEventListener('click', () => applyScenarioById(scenarioSelect.value));
    $('calc').addEventListener('click', runCalc);
    $('copy').addEventListener('click', () => navigator.clipboard?.writeText(reqArea.textContent || ''));
    $('download').addEventListener('click', downloadRequest);

    // initialize with the first scenario
    if (scenarios.length) { scenarioSelect.value = scenarios[0].id; applyScenarioById(scenarios[0].id); }
    showRequest(buildRequest());
  </script>
</body>
</html>